---
name: ğŸ—¿ Auto set project status

on:
  workflow_call:

jobs:
  set-status:
    runs-on: ubuntu-24.04
    permissions:
      pull-requests: write
      repository-projects: write
    steps:
      - name: â¬‡ï¸ Checkout
        uses: actions/checkout@v6

      # https://docs.github.com/en/apps/creating-github-apps/authenticating-with-a-github-app/making-authenticated-api-requests-with-a-github-app-in-a-github-actions-workflow
      - name: ğŸ§¬ Generate a token
        id: generate-token
        uses: actions/create-github-app-token@v2
        with:
          app-id: ${{ vars.AUTO_MERGE_APP_ID }}
          private-key: ${{ secrets.AUTO_MERGE_PRIVATE_KEY }}

      - name: ğŸ—¿ Set project status
        env:
          GITHUB_TOKEN: ${{ steps.generate-token.outputs.token }}
          PROJECT_NUMBER: 6
          PR_URL: ${{ github.event.pull_request.html_url }}
          EVENT_ACTION: ${{ github.event.action }}
          IS_DRAFT: ${{ github.event.pull_request.draft }}
        run: node scripts/github/set-project-status.ts
        continue-on-error: true
