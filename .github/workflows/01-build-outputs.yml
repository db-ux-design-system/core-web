---
name: Build outputs

on:
  workflow_call:

jobs:
  build-showcases:
    name: Build outputs
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        outputs: [angular, react, vue]
    steps:
      - name: â¬‡ Checkout repo
        uses: actions/checkout@v3

      - name: â¬‡ Download Components
        uses: db-ui/mono/.github/actions/download-tar-artifact
        with:
          name: db-ui-components
          path: packages/components

      - name: ðŸ”„ Init Cache
        uses: db-ui/mono/.github/actions/npm-cache
        id: "npm-cache"

      - name: ðŸ“¥ Download deps showcase-npm-cache
        if: steps.npm-cache.outputs.cache-hit != 'true'
        uses: bahmutov/npm-install@v1

      - name: ðŸ”¨ Build outputs ${{ matrix.outputs }}
        run: |
          cd packages/components/output/${{ matrix.outputs }}
          npm run build

      - name: â¬† Upload output ${{ matrix.outputs }}
        uses: db-ui/mono/.github/actions/upload-tar-artifact
        with:
          name: output-${{ matrix.outputs }}
          path: packages/components/output/${{ matrix.outputs }}

      - name: ðŸ’€ Killing me softly
        uses: db-ui/mono/.github/actions/cancel-workflow
        if: failure()
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
