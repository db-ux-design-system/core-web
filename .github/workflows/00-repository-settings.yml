---
name: Repository Settings

permissions:
  contents: read

on:
  workflow_call:
    inputs:
      release:
        required: false
        default: "false"
        type: string
      preRelease:
        required: false
        default: "false"
        type: string
    outputs:
      name:
        description: "Branch or Tag name"
        value: ${{ jobs.repository-settings.outputs.name }}
      baseUrl:
        description: "Base URL for the repository"
        value: ${{ jobs.repository-settings.outputs.baseUrl }}
      repoName:
        description: "Repository name"
        value: ${{ jobs.repository-settings.outputs.repoName }}
      repoOwner:
        description: "Repository owner"
        value: ${{ jobs.repository-settings.outputs.repoOwner }}

jobs:
  repository-settings:
    name: Repository Settings
    runs-on: ubuntu-24.04
    outputs:
      name: ${{ steps.result.outputs.name }}
      baseUrl: ${{ steps.result.outputs.baseUrl }}
      repoName: ${{ steps.result.outputs.repo }}
      repoOwner: ${{ steps.result.outputs.owner }}
    steps:
      - name: ⏬ Checkout repo
        uses: actions/checkout@v5

      - name: 🛤 Extract name and base
        id: extract-name-and-base
        uses: actions/github-script@v8
        with:
          script: |
            const { default: extractNameAndBaseUrl } = await import('${{ github.workspace }}/scripts/github/extract-name-and-base-url.js');
            return extractNameAndBaseUrl(context);

      - name: ✒️ Write to output
        id: result
        env:
          RESULT: ${{ steps.extract-name-and-base.outputs.result }}
          NAME: ${{ toJSON(steps.extract-name-and-base.outputs.result).name }}
          BASE_URL: ${{ toJSON(steps.extract-name-and-base.outputs.result).baseUrl }}
          REPO_NAME: ${{ toJSON(steps.extract-name-and-base.outputs.result).repo }}
          REPO_OWNER: ${{ toJSON(steps.extract-name-and-base.outputs.result).owner }}
        run: |
          echo "name=$NAME" >> $GITHUB_OUTPUT
          echo "baseUrl=$BASE_URL" >> $GITHUB_OUTPUT
          echo "repo=$REPO_NAME" >> $GITHUB_OUTPUT
          echo "owner=$REPO_OWNER" >> $GITHUB_OUTPUT
