@use "@db-ux/core-foundations/build/styles/variables";
@use "@db-ux/core-foundations/build/styles/colors";
@use "@db-ux/core-foundations/build/styles/helpers";
@use "../../styles/internal/form-components";
@use "../../styles/internal/component";
@use "../../styles/multi-select-components";
@use "../../styles/select-components";
@use "../../styles/internal/scrollbar";

%multi-select-placement-top {
	inset-block-end: 100%;
	margin-block-start: variables.$db-spacing-fixed-md;
}

%multi-select-placement-vertical {
	&[data-placement$="end"] {
		.db-multi-select-dropdown:not([data-outside-vx="right"]) {
			inset-inline-end: 0;
		}
	}

	.db-multi-select-dropdown[data-outside-vx="right"] {
		inset-inline-end: 0;
	}
}

%multi-select-placement {
	&:not([data-placement]),
	&[data-placement^="bottom"] {
		@extend %multi-select-placement-vertical;
		.db-multi-select-dropdown:not([data-outside-vy="bottom"]) {
			inset-block-start: 100%;
			margin-block-end: variables.$db-spacing-fixed-md;
		}
		.db-multi-select-dropdown[data-outside-vy="bottom"] {
			@extend %multi-select-placement-top;
		}
	}

	&[data-placement^="top"] {
		@extend %multi-select-placement-vertical;
		.db-multi-select-dropdown:not([data-outside-vy="top"]) {
			@extend %multi-select-placement-top;
		}
	}
}

.db-multi-select {
	--db-form-component-padding-inline-end: #{select-components.$select-icon-padding};

	@extend %select-icon;
	@extend %select-placeholder;
	@extend %multi-select-placement;

	position: relative;

	min-inline-size: variables.$db-sizing-xl;

	&:not([data-width]),
	&[data-width="full"] {
		&,
		.db-multi-select-dropdown,
		.db-multi-select-form-field {
			inline-size: 100%;
			max-inline-size: 100%;
		}
	}

	@include form-components.set-default-form-component(summary);

	[id$="-placeholder"] {
		display: none;
		margin-inline-end: calc(
			#{form-components.$font-size-height} +
				#{variables.$db-spacing-fixed-sm}
		);
	}

	&:has(.db-multi-select-form-field:empty),
	&:has(.db-multi-select-form-field > :empty) {
		[id$="-placeholder"] {
			display: block;
		}
	}

	.db-multi-select-header {
		display: none;
	}

	.db-notification {
		display: none;
	}

	/*&:has(.db-multi-select-header) {
		&:is([data-header-enabled="true"], :not([data-header-enabled])) {
			.db-multi-select-dropdown {
				max-block-size: multi-select-components.$max-height;
			}
		}
	}*/

	&[data-header-enabled="true"] {
		.db-multi-select-header {
			display: flex;
		}
	}

	&[data-notification-enabled="true"] {
		.db-notification {
			display: grid;
		}
	}

	&[data-hide-label="true"] {
		--db-label-visible-height: 0;
		--db-label-visible-spacing: 1;
	}

	&[data-selected-type="tag"] {
		&[data-wrapping="overflow"] {
			.db-multi-select-form-field {
				> div {
					@extend %scrollbar;

					overflow: auto hidden;

					.db-tag {
						flex-shrink: 0;
						flex-grow: 0;
					}
				}
			}
		}

		&:not([data-wrapping="overflow"]) {
			.db-multi-select-form-field {
				&:has(:not(div:empty)) {
					padding-block: variables.$db-spacing-fixed-xs;
					block-size: auto;

					> div {
						flex-wrap: wrap;
					}
				}

				> button {
					align-self: start;
				}
			}
		}
	}

	&[data-variant="hidden"] {
		--db-label-visible-height: 0;
		--db-label-visible-spacing: 1;
	}
}
