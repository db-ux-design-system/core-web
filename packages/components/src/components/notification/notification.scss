@use "sass:map";
@use "@db-ux/core-foundations/build/styles/density";
@use "@db-ux/core-foundations/build/styles/variables";
@use "@db-ux/core-foundations/build/styles/helpers";
@use "@db-ux/core-foundations/build/styles/colors";
@use "@db-ux/core-foundations/build/styles/icons";
@use "@db-ux/core-foundations/build/styles/screen-sizes";
@use "../../styles/internal/component";
@use "../../styles/internal/link-components";
@use "./notification-grid-default";
@use "./notification-grid-overlay";
@use "./notification-grid-non-overlay";

%timestamp-line-height-adjustments {
	// Adjusts line-height for elements when timestamp is present
	&:has(span) {
		header,
		p,
		&::before,
		.db-button {
			/* stylelint-disable-next-line db-ux/use-spacings */
			margin-block-start: -2px;
		}
	}
}

.db-notification {
	@extend %component-border;
	@extend %grid-layout-default;
	@extend %timestamp-line-height-adjustments;
	@include helpers.display(grid);

	padding: variables.$db-spacing-fixed-md;
	gap: variables.$db-spacing-fixed-xs variables.$db-spacing-fixed-md;
	inline-size: inherit;
	background-color: colors.$db-adaptive-bg-basic-level-2-default;

	&::before {
		--db-icon-color: #{colors.$db-adaptive-on-bg-basic-emphasis-70-default};
	}

	a {
		@extend %db-default-link;

		// Overwrite settings for db-link ALWAYS
		&::before,
		&::after {
			content: none !important;
			margin: 0 !important;
		}

		&[data-variant="brand"] {
			@extend %db-link-default-color;
		}

		&[data-size="small"] {
			@extend %db-overwrite-font-size-md;
		}
	}

	// headline
	header {
		grid-area: head;

		&,
		h1,
		h2,
		h3,
		h4,
		h5,
		h6 {
			margin: 0;
			font: var(--db-type-body-md);
			font-weight: 700;

			&::before,
			&::after {
				--db-icon-font-size: var(--db-base-body-icon-font-size-md);
				--db-icon-font-weight: var(--db-base-body-icon-weight-md);
			}
		}
	}

	// content
	p {
		@extend %db-overwrite-font-size-md;

		grid-area: content;
		margin: 0;
	}

	// Image styling and grid positioning
	img {
		min-block-size: variables.$db-sizing-md;
		min-inline-size: variables.$db-sizing-md;
		max-block-size: variables.$db-sizing-md;
		max-inline-size: variables.$db-sizing-md;
		border-radius: variables.$db-border-radius-xs;
		object-fit: cover;
		grid-area: icon;
	}

	// timestamp
	span {
		@extend %db-overwrite-font-size-sm;

		grid-area: timestamp;
		white-space: nowrap;
		justify-self: end;
	}

	.db-button {
		grid-area: close;
	}

	// Inline links stay within content flow
	&[data-link-variant="inline"] a {
		// 1. Weise den Link dem "timestamp" Bereich zu.
		//    Alle Layouts (overlay und default) müssen diesen Bereich kennen.
		grid-area: timestamp;
		white-space: nowrap;

		// 2. Richte den Link am Ende (rechts) seiner Grid-Zelle aus
		justify-self: end;

		// 3. Inline-Links sollen die 'md'-Größe haben (wie <p>),
		//    nicht 'sm' (wie <span>)
		@extend %db-overwrite-font-size-md;
	}

	// If an inline link is present, it takes precedence over the timestamp
	// Note: :has() pseudo-class has limited browser support (Firefox < 121)
	// Progressive enhancement - timestamps gracefully shown in older browsers
	&[data-link-variant="inline"]:has(a) {
		> span {
			display: none;
		}
	}

	// Block links get placed in grid area (default behavior)
	// This applies when linkVariant is "block" or not specified
	&:not([data-link-variant="inline"]) a {
		grid-area: link;
		white-space: nowrap;
	}

	// Icon grid positioning
	&[data-icon]::before,
	&::before {
		--db-icon-margin-end: 0;

		@include icons.to-filled-icon;

		grid-area: icon;
	}

	// If showIcon is explicitly set to false, hide the generated icon
	// pseudo-element.
	&[data-show-icon="false"]::before {
		/* Hidden when showIcon is explicitly false. Using `display:none`
		   is sufficient; avoid extra properties that don't affect layout. */
		display: none;
	}

	&:has(img) {
		// Hide icon when image is present to avoid conflicts
		&::before {
			content: none !important;
		}
	}

	&[data-variant="overlay"] {
		@extend %grid-layout-variant-overlay;

		box-shadow: variables.$db-elevation-md;
	}

	// Apply non-overlay grid layout for notifications with block links
	// This applies when linkVariant is "block" (explicit or default when links are present)
	&:not([data-variant="overlay"]) {
		&[data-link-variant="block"],
		&:not([data-link-variant]):has(a) {
			@extend %grid-layout-variant-not-overlay;
		}
	}

	&[data-variant="overlay"],
	&[data-variant="standalone"] {
		@extend %default-card;
	}

	@each $name in colors.$variant-colors {
		&[data-semantic="#{$name}"] {
			@extend %db-#{$name}-variables;
			@include icons.variant-icons($name);

			&::before {
				@extend %icon;
			}
		}
	}
}
