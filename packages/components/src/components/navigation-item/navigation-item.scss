@use "@db-ui/foundations/build/scss/variables" as *;
@use "@db-ui/foundations/build/scss/variables.global" as *;
@use "@db-ui/foundations/build/scss/helpers/component" as *;
@use "@db-ui/foundations/build/scss/color/color-variants" as *;
@use "@db-ui/foundations/build/scss/icon/icons.helpers" as *;
@use "@db-ui/foundations/build/scss/helpers/functions" as *;
@use "@db-ui/foundations/build/scss/helpers/component" as *;
@use "@db-ui/foundations/build/scss/animation/animations" as *;
@use "@db-ui/foundations/build/scss/icon/icons.placeholder" as *;
@use "@db-ui/foundations/build/scss/icon/icons.helpers" as *;
@use "@db-ui/foundations/build/scss/icon/icons.variables" as *;
@use "../../styles/db-puls" as *;

%icon-passing {
	// TODO: Probably we could still simplify the following two blocks of declarations
	&[data-icon] {
		&::before {
			// don't show default icon
			display: none;
		}
	}

	@each $icon-name, $icon-glyph in $icon-glyphs {
		&[data-icon="#{$icon-name}"] {
			> a,
			> .db-navigation-item-expand-button:is(button),
			> .db-navigation-item-expand-button > button {
				&::before {
					@extend %icon;
					content: "#{$icon-glyph}";
					margin-inline-end: var(
						--icon-margin-after,
						#{$db-spacing-fixed-sm}
					);
				}
			}
		}
	}
}

%sub-navi-handler-desktop {
	// show sub-navigation on hover
	@include screen("m") {
		&:hover,
		&:focus-visible {
			& ~ .db-sub-navigation {
				visibility: visible;
			}
		}
	}
}

@mixin sub-navi-handler-mobile() {
	// show/hide sub-navigation by click
	&[aria-expanded="true"] {
		& ~ .db-sub-navigation {
			visibility: visible;
			transition: visibility 0ms linear 0ms;
			animation: show-right-to-left $animation-show-timing;

			.db-sub-navigation {
				inset-block: 0;
			}
		}
	}

	&:not(&[aria-expanded="true"]) {
		& ~ .db-sub-navigation {
			transition: visibility 0ms linear 410ms; // hide animation is 0.4s
			animation: hide-right-to-left $animation-hide-timing;
		}
	}
}

%navigation-item {
	@extend %default-interactive-component;
	@extend %transparent-border;

	@include get-variant-bg-color(0);
	cursor: pointer;
	inline-size: 100%;
	display: inline-flex;

	border-radius: $default-card-border-radius;
	padding: $db-spacing-fixed-xs $db-spacing-fixed-sm;
	white-space: nowrap; // we don't want to break
	text-align: center;
	align-items: center; // Centering the content vertically and horizontally

	&:hover,
	&:focus-visible,
	&:has(~ .db-sub-navigation:hover),
	&:has(~ .db-sub-navigation:focus-visible),
	&:has(~ .db-sub-navigation:focus-within) {
		@include get-variant-bg-color(0.16);
	}

	&:active {
		@include get-variant-bg-color(0.24);
	}

	&::after {
		--icon-margin-before: auto;
	}
}

.db-navigation-item {
	@extend %db-puls;
	@extend %icon-passing;

	display: inline-flex;
	position: relative;
	inline-size: 100%;

	a {
		@extend %navigation-item;
		text-decoration: none;
	}

	.db-navigation-item-expand-button {
		@include screen("m", "max") {
			@include sub-navi-handler-mobile();
		}

		&:is(button),
		& > button {
			@extend %sub-navi-handler-desktop;
			@extend %navigation-item;

			// default icon for navigation
			@include icon(glyph(chevron-right), 24, "outline", "after");

			font-weight: inherit;
		}
	}

	&[aria-current="page"] {
		font-weight: 700;
	}

	&:not([aria-current="page"]) {
		// revert for sub-navigation
		font-weight: normal;
	}

	&[data-width="full"] {
		inline-size: 100%;

		&::after {
			--icon-margin-before: auto;
		}
	}

	&[aria-disabled="true"] {
		opacity: $default-opacity;
		pointer-events: none;
	}
}

@mixin sub-navigation-mobile() {
	padding: $db-spacing-fixed-md;
	inline-size: 100%;
	position: fixed;
	// additional #{$db-spacing-fixed-regular-3xs} for border
	inset-block: calc(
			#{$default-mobile-header-height} + #{$db-spacing-fixed-regular-3xs}
		)
		calc(
			#{$db-sizing-md} + #{$db-spacing-fixed-xs} * 2 + #{$db-spacing-fixed-regular-3xs}
		);
}

.db-sub-navigation {
	margin: 0;
	display: flex;
	flex-direction: column;
	z-index: 70;
	inset-inline-start: 0;
	background-color: $db-colors-neutral-bg;

	visibility: hidden;

	@include screen("m", "max") {
		@include sub-navigation-mobile();
	}

	@include screen("m") {
		.db-mobile-navigation-back {
			display: none;
		}
	}

	@include screen("m") {
		border-radius: $default-card-border-radius;
		box-shadow: $db-elevation-4;
		padding: $db-spacing-fixed-sm;

		position: absolute;
		min-inline-size: 328px; // We should get this value from UX

		inset-block-start: calc(100% + #{$db-spacing-fixed-md});

		transition: visibility 1ms linear; // workaround to enable focus with keyboard

		&:hover,
		&:focus-within {
			visibility: visible;
		}

		&::before {
			content: "";
			position: absolute;
			inset-inline-start: 0;
			inline-size: 100%;
			// #{$db-spacing-fixed-regular-3xs} for shadows
			block-size: calc(
				#{$db-spacing-fixed-regular-3xs} + #{$db-spacing-fixed-md}
			);
			inset-block-start: calc(
				-1 * #{$db-spacing-fixed-md} - #{$db-spacing-fixed-regular-3xs}
			);
		}

		.db-sub-navigation {
			// 1px for box shadow
			inset-block-start: calc(-50% + $db-spacing-fixed-xs + 1px);
			inset-inline-start: calc(100% + $db-spacing-fixed-xs);

			&::before {
				content: "";
				padding: $db-spacing-fixed-xs;
				// #{$db-spacing-fixed-regular-3xs} for box shadow
				inset-block-start: #{$db-spacing-fixed-regular-3xs};
				inset-inline-start: calc(-1 * #{$db-spacing-fixed-xs});
				block-size: 100%;
				inline-size: $db-spacing-fixed-xs;
			}
		}
	}

	&:empty {
		display: none;
	}

	.db-navigation-item {
		inline-size: 100%;

		&::after {
			margin-inline-start: auto;
		}
	}
}

.db-mobile-navigation-back {
	@include divider("bottom");
	display: flex;
	font-weight: normal;
	background-color: $db-colors-neutral-bg-0-enabled;
	padding-block-end: $db-spacing-fixed-md;
	margin-block-end: $db-spacing-fixed-md;
}
