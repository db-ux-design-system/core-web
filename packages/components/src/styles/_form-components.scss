@use "sass:map";
@use "@db-ui/foundations/build/scss/icon/icon-helpers";
@use "@db-ui/foundations/build/scss/helpers/font";
@use "@db-ui/foundations/build/scss/variables";
@use "@db-ui/foundations/build/scss/helpers/component";
@use "@db-ui/foundations/build/scss/color/color-variants";

$dropdown-icon-transition: transform variables.$db-transition-emotional-straight;
$dropdown-icon-transform: rotate(-180deg);

%dropdown-icon {
	@include icon-helpers.icon("expand_more", "after");

	&::after {
		transition: $dropdown-icon-transition;
	}
}

%default-form-message {
	& .db-infotext {
		margin-block-start: variables.$db-spacing-fixed-2xs;
	}
}

%default-form-label {
	label {
		@extend %db-overwrite-font-size-xs;
		display: flex;
		align-items: center;
		padding-block-end: variables.$db-spacing-fixed-xs;

		cursor: text;

		&[data-overflow="true"] {
			max-inline-size: 25ch;
			text-overflow: ellipsis;
			white-space: nowrap;
			overflow: hidden;
		}
	}
}

%disabled-form-element {
	&:has(input:disabled),
	&:has(textarea:disabled),
	&:has(select:disabled) {
		& {
			// Decided against cursor: not-allowed, compare to e.g. https://phabricator.wikimedia.org/T121960
			opacity: component.$default-disabled-opacity;
			pointer-events: none;
		}
	}
}

%required-form-element {
	&:has(+ :required) {
		&::after {
			content: "*";
			padding-inline-start: var.$db-spacing-fixed-2xs;
		}
	}
}
%required-form-element-check {
	:required + & {
		&::after {
			content: "*";
			padding-inline-start: variables.$db-spacing-fixed-2xs;
		}
	}
}

@mixin get-input-color-variants() {
	@each $name, $colors in color-variants.$component-variants {
		&[data-variant="#{$name}"] {
			--db-current-border-color: #{map.get($colors, "border")};
		}

		&[data-variant="#{$name}"] {
			--db-current-color: #{map.get($colors, "on-bg")};
			color: map.get($colors, "on-bg");
		}

		&[data-variant="#{$name}"] select {
			--db-current-color: #{map.get($colors, "on-bg")};
			color: map.get($colors, "on-bg");
		}

		&[data-variant="#{$name}"] input,
		&[data-variant="#{$name}"] textarea,
		&[data-variant="#{$name}"] select {
			@if ($name == "critical") {
				@extend %adaptive-critical-component;
			} @else if ($name == "informational") {
				@extend %adaptive-informational-component;
			} @else if ($name == "warning") {
				@extend %adaptive-warning-component;
			} @else if ($name == "successful") {
				@extend %adaptive-successful-component;
			}
		}
	}
}

%validity {
	// Valid
	// Programmatic valid status, most likely set via JavaScript
	&[aria-invalid="false"], // programmatically set validity
	&:is(:user-valid):not([aria-invalid]) {
		@extend %adaptive-successful-component;

		// label:has(+ &) {
		// 	color: $db-colors-successful-element;
		// }
	}
	// :user-valid workaround
	@supports not selector(:user-valid) {
		&:required:valid:not(:placeholder-shown) {
			@extend %adaptive-successful-component;

			// label:has(+ &) {
			// 	color: $db-colors-successful-element;
			// }
		}
	}

	// Invalid
	// Programmatic invalid status, most likely set via JavaScript
	&[aria-invalid="true"],
	&:is(:user-invalid) {
		@extend %db-bg-critical-transparent-semi;

		// label:has(+ &) {
		// 	color: $db-colors-critical-element;
		// }
	}
	// :user-invalid workaround
	@supports not selector(:user-invalid) {
		&:required:invalid:not(:placeholder-shown) {
			@extend %db-bg-critical-transparent-semi;

			// label:has(+ &) {
			// 	color: $db-colors-critical-element;
			// }
		}
	}
}
